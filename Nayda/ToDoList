ToDo List.

Initialialized on April 17.04.2018


Started 17.04.2018

    1) Rework the Create Lobby Page.

        1.1 Add the Settings Button (OK)
        1.2 Add the Setting Widget (OK)
        1.3 Rework "Start with Default Settings" button (OK)

Continued 19.06.2018

   2) Pass the size of the "Before The Game" to all the other non-Modal dialogs.

Continued 08.07.2018

   1) To Do server to accept many connections.
   http://qt-doc.ru/realizacia-servera-s-pomoschu-klassa-qtcpserver.html

Continued 16.07.2018

    0) Rebuild starting menu
        0.1. Remove Create_Lobby and Find_Lobby buttons (Ok)
        0.2. Replace them with Play! Button (Ok)
        0.3. Rework the Play! Menu
            0.3.1 Make it the same size as Before The Game (Ok)

    1) To create satisfactory connection mode with server:
        1.1. During setting saving to report user that they are successfuly save
        1.2. Show them in the label

    2) To make independent button "Connect to server"

    3) Server should reply client directly after conenction whether there are some free room slots
        or possibility to connect to some room

    4) According to 3), there should be another window of the "Connected Mode"
        4.1 "Connected" state info label with basic server info and status
        4.2 Create room (if it is possible)
        4.3 Observe free rooms (if it is possible)

    5) If there is place for new room, there should appear room-creation dialog with settings.
        5.1 Procedure:
            5.1.1 User push the button to create room and reserve it on server
            5.1.2 Server will reject connections to this room, but allowing
            clients to see it in "connection to existing room" mode, replying:: room is creating.
            5.1.3 User select settings. By 16.07.2018 - only default button will exist
            5.1.4 After selecting settings (selection boxes), user will start the game pressing the button
            5.1.5 Before sening settings and command to server, user will see the message "Are you sure?"

    6) Client should be able to report user whether it was disconnected
        6.1 To make special Icon "Connected" somewhere in all the "connected phase windows"
        6.2 To make spceial procedure of exception if connection was closed.
        6.3 If anyone of the clients (or all of them) will be diconnected, server should save the Game
        on its own. Mark the Game with data and nicknames. Master will be the one who can restart (or anyone).

    7) Add protobuf.

8) Make this before building protobuf on Windows
export PATH=/c/Qt/Tools/mingw530_32/bin/:$PATH
//Home Working Machine
export PATH=/d/Qt/Tools/mingw530_32/bin/:$PATH

/d/Munchkin/Nayda/Libs/protoc.exe --cpp_out=. serverMessageSystem.proto
/d/Munchkin/Viluy/Libs/protoc.exe --cpp_out=. serverMessageSystem.proto

//Home Working Machine
/d/Munchkin/Nayda/Nayda/Libs/protoc.exe --cpp_out=. serverMessageSystem.proto
/d/Munchkin/Viluy/Libs/protoc.exe --cpp_out=. serverMessageSystem.proto

Continued 17.11.2018
Now protobuf is added, messages are coming there and back again, roomcreationlobby and the other issues are imlemented.

Now to:

ProcessConnectionToRoomReply. Now to:
1) Show The User expected Window
2) Disconnect Buttons Connect To Room and Create Room while Sending ConnectionToRoomRequest + adding there timeout (if server do not reply)??? - not sure if necessary.
3) Adding QueryPostitonWindow (It should be close able, but if the user closes it, he disconnect's from the server)
4) Adding EnterRoomRepy from server side. It may be the same message, but with special parameters. After it the user should see RoomCreationWaitingLobby as not the master but as the Opponent.
5) Emit Client is Entering the room on server side when the server sconnect the player to room.
6) On the RoomSelections Window send the signal to connect to the existing Room. Check it on the Servers side.
7) When all the Opponents have entered, set the GameBegins message
and finally switch to THE GAME!!!!!

//Добавить сообщени в список енумерейшена коннекшн сабсситем
//Переработать составитель ClientConnectionToRoomReply в сервере с учётом нового списка собщений
//Из него создать требуемый зал
//На стороне сервера отправлять сообщения об изменениях / удалениях комнат
        //В данном контексте с учётом залоченных параметров достаточно просто отправлять их тем, кто стосит в очереди, т.к.
        //Эти клиенты находятся в стадии ожидания.
//Обработать их на стороне клиента соответствующим образом
//Добавить сообщение от клиента о выбранной комнате на стороне клинета
//Обработать его на стороне сервера
//Т.е. добавить клиента в требуемую комнату.


//Остановился на     QObject::connect(m_serverPtr, &Server::SignalProcessClientConnectionToRoomReply, m_beforeTheGamePtr, &Before_The_Game::SlotProcessClientConnectionToRoomReply);
В Ситемном менеджере.
Добавить заполенние//изменение поля имени комнаты.
 ответе сервера передавать игроку информацию о числе игроков в очереди (чтобы он адекватно понимал свою позицию)
Переделать протобф на сервере
Обработать сигналы оот сервера в ответ на запрос о подсоединении к комнате если запрос ответил о возможнности подключения (передал комнаты)
т.е. соединить сигналы
На сервере обрабоать новый запрос на создание комнаты,
добавить в комнату параметр имени
Правильно сформировать новый ответ на зпапрос о подключении к комнате.

Продолжен 26.11.2018
1) Сделать дебажную настройку "2"
Чтобы начать игру могли только два игрока
Ок
2) Сервер послыает всем сообщение, что сейчас начнётся игра.
Ок. В т.ч. теперь шлёт наборы векторов рандомных чисел для формирования колоды

3) Запустить игровой таймер старта, для начала подвязать его на дебажную кнопку
"Начать игру"

3) Отработать ситуацию, когда игрок уходит до начала игры.
4) Отработать ситуацию ухода игроков в процессе игры.
(Если игрок остаётся один - игра закрывается)
5) Начать разрабатывать собственно игровой процесс после перехода в режим "Игра"



Исправить баг с взаимным передпокдлючением - когда просиходит переназнаячение мастера,
вновь подключившийся клиент (который раньше был мастером)
не именуется в новом окне.


Проверить, сообщается ли о подключении нового клиента мастеру.


//27.11.2018
Перед продолжением рефакторинга, направленного на взаимодействие с сервером, для начал провести оптимизацию игрового интерфейса,
т.к. в настоящий момент отображение на Линухе - не очень.
Собственно потратил кучу времени н аоптимизацию под Линух, получается, что координаты возвращаются верные. Однако, QWidget::show
не отображает желаемого результата.


Проблему можно (и нужно) обойти созданием дополнительного виджета просмотра карты.
Его нужно встроить в игровой клиент.


//28.11.2018
Сегодня впервые два клиента соединились через сервер и открыли окно игры

//29.11.2018
0. Проработать интерфейс поля боя.
    А) Должно содержать интерфейс таймеров (таймеров всегда два - таймер хода / таймер фазы)
    Б) Должно содержать интерфейс карт
        Б) Интерфейс карт - три части, две строки и столбец. Снизу интерфейс карт игрока ("За Себя"). Сверху интерфейс карт "против игрока".
        Интерфейс "За себя" : слева карта "Игрока" (Аватарка "по умолчанию")
                              правее все его карты, которые он сыграл за себя (усилители).
        Интерфейс "Против игрока" : слева карта монстра (монстров + бродячие твари), правее усилители монстра.
        Интерфейс "Карты специальных функций" - Активная - одна, сверху ютятся все, которые уже произвели эффект.
        Возмонжо, те из них, которые "продолжают действие", можно как-то подсвечивать.




1. Реализовать запуск таймера в игровом поле:
(Игра начнётся через....)

2. Передать управление игроку.
Найти место для отображения игровых таймеров.
Рисунок часов, а "тикают" цифры.


Завтра начать с него
3. _slotSendTheCardToTheGameCheck

Проверка карты (написать грамотно).
Клиент сообщает о том, кто ходит первый.

Первым ходит мастер.
Завтра продолжить отсюда.
connect(animation, &QPropertyAnimation::finished, [this, card] {SlotAddPlayedCardToTheBattleField(card.GetCard());});

1.12.2018
//Предыдущее сделать позднее.
//Сначала сделать процедуру определения того, кто должен ходить первым.
//Пусть дебаговая кнопка передаст настоящие имена
    Сдлеать функцию, которая определяет, кто должен ходить первым. Клиент определяет, что это не он, и ждёт своей очереди.
    Запускается процесс ожидания игрока 2 или своего собственного.
    Последовательность фаз выглядит следующим образом:
    Если персонаж не вор, первой наступает фаза торговли.
    Чтобы она включилась, клиент проверяет, что у него достаточно карт на руках и / или в игре с достаточной стоимотсью
    стобы насобирать хотябы уровень.
    Далее он предлагает ему согласиться/отказаться от продажи карт.
    Если игрок НЕ ВОР и он отка


//В самом начале игра должна проверить, кто сейчас ходит.
//Если ходит не главный игрок - для начальной проверки клиенту
//не нужно получать от сервера дополнительных сообщений -
//требуется сличить имя игрока из настроек с именем мастера.
//Для всех последующих итераций сервер также стартует таймеры,
//но только для того, чтобы по таймауту отключить игрока.
//клиент же при молчании игрока делает ход сам (самый простой  - открывает дверь)
//больше он не делает ничего.
//сервер (по идее - сам поймёт, что клиент отключился).
//т.к. произойти это может в любой момент времени,
//клиент, получив подобное сообщение, должен сам произвести все действия, которые
//за этим следуют.
//По сути для клиента есть два состояния - "свой ход" и "не свой ход"
//1. Сначала полностью отладить "свой ход" без противодействия /действия других игроков
//2. Добавить воздействие других игроков "не свой ход"
//3. Обеспечить корректные действия сервера по таймаутам -
//   Сервер передаёт сообщения, по которым сменяются фазы.
//   Клиенты в этот момент находятся в фазе "ожидание ответа сервера"
//   Т.е. у главного клиента должен сработать "таймаут", он должен передать сообщение на сервер
//   Не позднее, чем общее время хода игрока (или какое-нибудь другое время).
//   Если клиент ничего не прислал, сервер должен выкинуть его по таймауту,
//   Т.к. во всех остальных случаях клиент пришлёт репорт
//   Если какой-нибудь клиент три раза подряд пришлёт "автоматический" ход
//   Этот клиент будет автоматически отключен от сервера.


//02.12
Сделать окно продажи

//03.12
Отлаживал баг с динамически мзоданием игроков

//04.12
Отладил.
Отработать корректное нажатие кнопки Ок в окне продажи
Добавить настройку (встроенную) для окна продажи.
    Обозначать её как NAY-002_EMBEDDED_SETTING
    Такие можно будет потом добавлять в игру как настоящие настройки
Эта настройка должна запрещать "перепродажу" карт - чтобы игрок не мог "скинуть лишние"
при продаже

//07.12
1) Добавлять сброшенные карты в сброс в конце анимации ---> Ok
2) Добавлять уровень в зависимости от объёма проданных карт ---> Ok
3) Пофиксить баг с четвёртой картой на продажу ---> Ok
4) Сделать всплывающее модальное сообщение (однократного использования)
с нотификацией ушедших в сброс карт --> Ok
5) блокировать кнопку "торговля" во время продажи --->Ok
6) Исправить баг с неправильно попадающей в сброс картой. ---> Ok.

//08.12
1) Сделать правильную раздачу карт ---Кажется, ещё вчера сделал
(Может быть, сделать специальный класс под это дело?)
2) Добавить сообщение о продаже карт игроком

парметры:
    номер игрока
    число полученных уровней
    вектор сброшенных карт в формате "простая карта"

3) Добавить сообщение об изменении игровой фазы:
    игровая фаза должна блокировать на время исполнения анимации использование
    любых карт

//09.12

Введена SetGlobalGamePhase(GlobalGamePhase::OwnMove);
Для запрета проверок на игроспособность и других функций игрока ГЛОБАЛЬНО
т.е. проверка на неё должна быть справделива в т.ч. и на время процессинга карт (н.р. уходящих в сброс, и т.п.)

В данный момент она запрещает отображение кнопки "торговля"

Далее (10.12) заняться void The_Game::SlotCheckThePossibilityForTheCardToBePlayed(PositionedCard card)

Начать с обычного хода игрока:


1) Применение сокровищ (шмоток)
    1.1 Создать виджет "Карты В игре"
    1.2 Такой виджет есть у каждого игрока, и по началу он показывает пустые карты
    1.3 Все применённые карты складываются туда.
    1.4 Любой игрок может смотреть этот виджет у любого игрока
    1.5 Внешним образом он проявляется только в увеличивающейся боевой силе
        и иконках, показывающих сопротивляемость игрока (эти иконки пока не делть и не отображать)
        1) к воровству
        2) к зельям
        3) к проклятьям, вышедшим из дверей
        4) к проклятьям, применённым игроками


2) Открытие Двери
    2) Пустая дверь
    3) Моснтр (битва)
3) Применение проклятий
3)

Продолжить 10.12 со строки 1930 TheGame.cpp
Сначала расписать границы применимости карты
Потом (если её возможно применить) передать управление одной из функций, которая будет подвязана к карте.
void GameFunctionFightWithMonsterFromHand(SimpleCard monster);


//10.12.2018
Иногда появляется баг, связанный, очевидно, с некорректным удалением карт из вектора "продажи".
Пользователю разрешается продавать карты, которые уже были удалены с руки.
Причём один раз одна из карт задублировалась.
Очевидно, это каким-то образом связано с нажатиями на кнопки во время самой торговли.
Но проявляется не постоянно.
Возможно, только когда карты переходят на новую страницу в виджете отображения карт на продажу?


//11.12.2018
Парсер возможности "сыграть" карту - не единственный.

А) СЫГРАТЬ КАРТУ

Так же должны быть парсеры возможности
Б) СБРОСИТЬ КАРТУ
В) ПРОДАТЬ КАРТУ (уже частично сделан).
    Известная недоделка на данный момент:
    Он должен будет также проверять, что на карте не висит "проклятая шняга"
Г) ПЕРЕДАТЬ КАРТУ

На данный момент не сделана даже механика СБРОСА и ПЕРЕДАЧИ.
Она будет разработана позднее.

Также должна быть специальная функция, позволяющая применять карту сразу с "Чит!" ом.

На данный момент все действия прописываются только для базового отыгрыша карты.
На будущее можно будет захардкодить настройку "Применять монстра не в свой бой при наличии карты Бродячая Тварь"
по умолчанию - без зажатия кнопки мыши и выбора функции.


//13.12.2018
1) Сделать анимацию розыгрыша карты, которая попадает в "карты в игре".
2) Сделать дополнительную панель (всплывающую), которая показывает дополнительные особенности
игрока (как пассивные, так и активные)
    Добавлять эти способности во всплывающую панель.

//16.12.2018
1) SEGFAULT во время вторичной анимации карты, отправляющейся в "Карты в Игре"
    (Не починен)
    Возможно, такйо же существует в т.ч. и для продажи

2) Во время продажи карт с руки и из игры:
    по результатам одной итерации правильно исчезают с руки
    не исчезают из cardsInGameObsrever.
    Карты не разъезжаются корректно - после "приезда" все карты должны разъезжаться правильно,
    неважно откуда они попали в игру. Птом уже ехать вместе.


После первой продажи вторичная продажа не корректно работает.
Удваивает карты, потом кнопка вообще исчезает.
Вероятно, неправильно работает "проверяльщик" продажи.
"Удваивает" - вектор карт "_availibaleToBeSold" не чистится.
Новый чекер докидывает в него значения.
Плчему исчезает - непонятно.
С утра начать с этого.

Потом продолжить уничтожением сегфалта.

//16.12.2018
Когда в сброс уходят карты с руки и из игры одновременно, в
отображателе сброшенных карт отображается
только последняя ---> исправил

После продажи карты из руки карта остаётся в отображателе (вычистить её оттуда)

//17.12.2018
Анимация продажи карт падает точно также.
Починить её. ---> починил (я надеюсь)

Потом сделать анимацию карт с руки ---> Ok (сделано)
Пофиксить баг с применением второй брони в "активные" карты.
-->пофиксил

Пофиксить баг с неотображением неактивных карт --- Ок

Баг с неправильным вычислением удалённых карт - "проверщик" торговли не видит,
что карта удалена -т.к. она не удаляется вектором. --- > возможно, сделал.

==Активные на вечер 17.12.2018
Пофикисть баг с невычитанием бонусов от удалённых карт.
Сделать текстовую подсказку о применении неактивной карты (по включенной настройке - в настоящее время захардкоженой).
Сделать так, чтобы выезжающие "из руки" карты ехали всё-таки не из одной стартовой позиции, а сдвигались влево и вправо на ширину карты от
первой карты. --ок, сделал

18.12.2018 пропустил, т.к. корпоратив.

19.12.2018
Сделать всплывающую подсказку о применении неактивной карты
Ок, сделал.

Сделать удаление карты.

Для этого надо продумать общую механику удаления/добавления карт
При передаче сообщения от сервера о применении карт клиент должен всё равно показать весь процесс
применения - соответственно, потребуется запустить соответствующую анимацию.
С другой стороны, клиент уже произвёл все вычисления и достаточно всего лишь передать их результат
на другую сторону в виде сообщения о применении карты

Игрок (имя)
Позиция (Рука Игра Поле и т.д.)
Карта (SimpleCard)
Действие (Применение/Сброс и т.п.)
Результат (Запрет не показывается (или показывается - определить настройками))

После чего клиент с другой стороны должен удалить/применить её.
С другой стороны у каждой карты есть её "применитель", из которого можно сделать с помощью дополнительного
флага "удалитель". Следовательно, чтобы не перегружать сетевое соединение, пусть каждый
клиент выполнит одинаковые операции. Процесорного времени больше, зато экономия трафика
и относительное единоообразие действий.

//22.12.2018
Отдохнул и хватит.

Новый "применитель" карт готов. В функции ApplyNewArmor введён признак CardApplyMode.
Он показывает, что треубется сделать с картой - удалить или применить.

Задачи:

1) Убрать подстветку BattleField --->Ok
2) Сделать поле "карты в игре" видимым для обоих игроков
3) Добавить для оппонентов виджет "Карты в Игре" и карты в руке
в виде двух лент перед собственно игроком
4) Сформиролвать сообщение для сервера о применениии карты и написать его обработчик


//23.12
На данный момент gamerWidget выглядит нормально.
Анимация, которая переносит карту в аватарку - отличная.

1) Связать анимацию отображения движущейся карты с появлением карты в игре
(посмотреть, насколько хорошо это будет смотреться) ---> Ок

2) Перенести для отображающихся сверху игроков-оппонентов отображения их "рук" и карт в игре
в сторону игрового поля (переместить виджеты в другие layout'ы)

3) Отобразить карты в руке игроков в виде реальных восьми карт (дверей-сокровищ)
на руке и переделать анимацию, беря за отправную точку позицию той карты, которая была на руке

Вернуться к пункту 4 от 22.12.2018



































